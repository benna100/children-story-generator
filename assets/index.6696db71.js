(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerpolicy&&(c.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?c.credentials="include":r.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();function z(){}function ve(t){return t()}function de(){return Object.create(null)}function J(t){t.forEach(ve)}function Te(t){return typeof t=="function"}function ke(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let W;function me(t,e){return W||(W=document.createElement("a")),W.href=e,t===W.href}function Pe(t){return Object.keys(t).length===0}function u(t,e){t.appendChild(e)}function A(t,e,n){t.insertBefore(e,n||null)}function I(t){t.parentNode.removeChild(t)}function Le(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function d(t){return document.createElement(t)}function U(t){return document.createTextNode(t)}function S(){return U(" ")}function je(){return U("")}function M(t,e,n,l){return t.addEventListener(e,n,l),()=>t.removeEventListener(e,n,l)}function a(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Be(t){return Array.from(t.childNodes)}function Ne(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function N(t,e){t.value=e==null?"":e}function x(t,e,n,l){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,l?"important":"")}let ce;function X(t){ce=t}const q=[],he=[],te=[],ge=[],$e=Promise.resolve();let se=!1;function He(){se||(se=!0,$e.then(Se))}function ie(t){te.push(t)}const oe=new Set;let Z=0;function Se(){const t=ce;do{for(;Z<q.length;){const e=q[Z];Z++,X(e),ze(e.$$)}for(X(null),q.length=0,Z=0;he.length;)he.pop()();for(let e=0;e<te.length;e+=1){const n=te[e];oe.has(n)||(oe.add(n),n())}te.length=0}while(q.length);for(;ge.length;)ge.pop()();se=!1,oe.clear(),X(t)}function ze(t){if(t.fragment!==null){t.update(),J(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ie)}}const ne=new Set;let De;function Ie(t,e){t&&t.i&&(ne.delete(t),t.i(e))}function Ke(t,e,n,l){if(t&&t.o){if(ne.has(t))return;ne.add(t),De.c.push(()=>{ne.delete(t),l&&(n&&t.d(1),l())}),t.o(e)}else l&&l()}function Me(t){t&&t.c()}function Ee(t,e,n,l){const{fragment:r,on_mount:c,on_destroy:p,after_update:i}=t.$$;r&&r.m(e,n),l||ie(()=>{const f=c.map(ve).filter(Te);p?p.push(...f):J(f),t.$$.on_mount=[]}),i.forEach(ie)}function Ae(t,e){const n=t.$$;n.fragment!==null&&(J(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Fe(t,e){t.$$.dirty[0]===-1&&(q.push(t),He(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ce(t,e,n,l,r,c,p,i=[-1]){const f=ce;X(t);const o=t.$$={fragment:null,ctx:null,props:c,update:z,not_equal:r,bound:de(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:de(),dirty:i,skip_bound:!1,root:e.target||f.$$.root};p&&p(o.root);let v=!1;if(o.ctx=n?n(t,e.props||{},(_,P,...O)=>{const y=O.length?O[0]:P;return o.ctx&&r(o.ctx[_],o.ctx[_]=y)&&(!o.skip_bound&&o.bound[_]&&o.bound[_](y),v&&Fe(t,_)),P}):[],o.update(),v=!0,J(o.before_update),o.fragment=l?l(o.ctx):!1,e.target){if(e.hydrate){const _=Be(e.target);o.fragment&&o.fragment.l(_),_.forEach(I)}else o.fragment&&o.fragment.c();e.intro&&Ie(t.$$.fragment),Ee(t,e.target,e.anchor,e.customElement),Se()}X(f)}class Oe{$destroy(){Ae(this,1),this.$destroy=z}$on(e,n){const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(n),()=>{const r=l.indexOf(n);r!==-1&&l.splice(r,1)}}$set(e){this.$$set&&!Pe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}async function ee({prompt:t,fake:e,openAiKey:n}){if(e)return`Ingeborg m\xF8der en delfin der kan spille guitar. Delfinen spiller en melodi, og Ingeborg synes, at det er den smukkeste musik, hun nogensinde har h\xF8rt. 
    Hun sp\xF8rger delfinen, om den kan l\xE6re hende at spille guitar. 
    Delfinen svarer, at det kan den godt. S\xE5 Ingeborg og delfinen begynder at spille guitar sammen. Og Ingeborg synes, at det er s\xE5 sjovt, at hun aldrig vil stoppe igen.`;const r=await(await fetch("https://api.openai.com/v1/completions",{headers:{"content-type":"application/json",Authorization:`Bearer ${n}`},method:"post",body:JSON.stringify({model:"text-davinci-002",prompt:t,temperature:.5,max_tokens:t.length*4})})).json();return console.log(r),r.choices[0].text&&r.choices[0].text.trim()}async function _e({prompt:t,prefix:e="",suffix:n="",fake:l,stableDiffusionKey:r}){return new Promise((c,p)=>{if(l)return setTimeout(()=>{c("https://cdn.dribbble.com/users/965441/screenshots/16233874/media/ac1494cf02cfce24c2e864bce1c2136a.jpg?compress=1&resize=1600x1200&vertical=top")},3e3);const i=new URLSearchParams;i.append("prompt",t),i.append("steps","50"),i.append("height","512"),i.append("guidance","7.5"),i.append("sampler","k_lms"),i.append("width","512"),fetch("https://dezgo.p.rapidapi.com/text2image",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded","X-RapidAPI-Key":r,"X-RapidAPI-Host":"dezgo.p.rapidapi.com"},body:i}).then(o=>o.blob()).then(o=>{const v=URL.createObjectURL(o);console.log("got a new url",v),c(v)}).catch(o=>{console.error(o),p(o)})})}function ye(t){let e=sessionStorage.getItem(t);return e&&e!=="null"&&e!==""}function be(t,e,n){const l=t.slice();return l[15]=e[n],l[17]=n,l}function Ve(t){let e;return{c(){e=d("button"),e.innerHTML='<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Vent venligst...',a(e,"class","btn btn-info w-84 self-center mt-6")},m(n,l){A(n,e,l)},p:z,d(n){n&&I(e)}}}function Re(t){let e,n,l;return{c(){e=d("button"),e.textContent="Generer din historie",a(e,"class","btn btn-primary mt-6 w-60 self-center")},m(r,c){A(r,e,c),n||(l=M(e,"click",t[7]),n=!0)},p:z,d(r){r&&I(e),n=!1,l()}}}function we(t){let e;return{c(){e=d("div"),e.textContent="Din historie:",a(e,"class","divider mb-10")},m(n,l){A(n,e,l)},d(n){n&&I(e)}}}function Ye(t){let e;return{c(){e=d("div"),e.innerHTML=`<svg class="animate-spin -ml-1 mr-3 h-12 w-12 text-primary m-8" style="margin: 0 auto;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> 
      <p class="mt-2 opacity-70 font-bold">henter dit billede</p>`,a(e,"class","flex align-center pt-24 flex-col bg-base-300 rounded text-center"),x(e,"height","270px"),x(e,"width","calc(100% - 12px)"),x(e,"border-radius","8px"),x(e,"margin","0 auto")},m(n,l){A(n,e,l)},p:z,d(n){n&&I(e)}}}function Ge(t){let e,n;return{c(){e=d("img"),me(e.src,n=t[15].image)||a(e,"src",n),a(e,"class","object-cover"),x(e,"width","calc(100% - 12px)"),x(e,"border-radius","8px"),x(e,"margin","0 auto")},m(l,r){A(l,e,r)},p(l,r){r&64&&!me(e.src,n=l[15].image)&&a(e,"src",n)},d(l){l&&I(e)}}}function xe(t){let e,n,l,r=t[17]+1+"",c,p,i,f,o=t[15].story+"",v,_,P,O,y,H,$,D;function g(h,m){return h[15].image?Ge:Ye}let L=g(t),b=L(t);return{c(){e=d("div"),n=d("div"),l=d("h2"),c=U(r),p=U("."),i=S(),f=d("p"),v=U(o),_=S(),b.c(),P=S(),O=d("div"),y=d("button"),y.innerHTML='<span class="pointer-events-none">Forts\xE6t historien</span><div style="display:none;" class="flex"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Vent venligst...</div>',H=S(),a(l,"class","font-bold text-2xl opacity-60"),a(f,"class","pt-4"),x(f,"line-height","2.5rem"),x(f,"font-size","1.5rem"),x(f,"white-space","break-spaces"),a(n,"class","p-10"),a(e,"class","bg-base-100"),x(e,"margin","0 auto"),x(e,"overflow","auto"),x(e,"min-height","400px"),x(e,"max-width","800px"),x(e,"border-radius","8px"),a(e,"id","chap-"+t[17]),a(y,"class","btn btn-primary w-60 self-center"),a(O,"class","text-center p-8")},m(h,m){A(h,e,m),u(e,n),u(n,l),u(l,c),u(l,p),u(n,i),u(n,f),u(f,v),u(e,_),b.m(e,null),A(h,P,m),A(h,O,m),u(O,y),A(h,H,m),$||(D=M(y,"click",t[8]),$=!0)},p(h,m){m&64&&o!==(o=h[15].story+"")&&Ne(v,o),L===(L=g(h))&&b?b.p(h,m):(b.d(1),b=L(h),b&&(b.c(),b.m(e,null)))},d(h){h&&I(e),b.d(),h&&I(P),h&&I(O),h&&I(H),$=!1,D()}}}function qe(t){let e,n,l,r,c,p,i,f,o,v,_,P,O,y,H,$,D,g,L,b,h,m,K,k,R,j,ae,le,Y,G,re,ue;function fe(s,w){return s[5]?Ve:Re}let Q=fe(t),B=Q(t),T=t[6].length>0&&we(),F=t[6],C=[];for(let s=0;s<F.length;s+=1)C[s]=xe(be(t,F,s));return{c(){e=d("h1"),e.textContent="Generer din egen b\xF8rnebog \u{1F4D6}",n=S(),l=d("div"),r=d("div"),c=d("div"),p=d("div"),i=d("p"),i.textContent="Barnets navn",f=S(),o=d("input"),v=S(),_=d("div"),P=d("p"),P.textContent="Barnets alder",O=S(),y=d("input"),H=S(),$=d("p"),$.textContent="Hvad skal historien handle om?",D=S(),g=d("textarea"),L=S(),b=d("p"),b.innerHTML='OpenAI kodeord api n\xF8gle. <a class="underline" href="https://github.com/benna100/children-story-generator#f%C3%B8r-du-starter">Guide her</a>',h=S(),m=d("input"),K=S(),k=d("p"),k.innerHTML='Stable Diffusion api n\xF8gle. <a class="underline" href="https://github.com/benna100/children-story-generator#f%C3%B8r-du-starter">Guide her</a>',R=S(),j=d("input"),ae=S(),B.c(),le=S(),T&&T.c(),Y=S();for(let s=0;s<C.length;s+=1)C[s].c();G=je(),a(e,"class","text-4xl pt-10 pb-10 text-center p-2"),a(i,"class",""),a(o,"class","input text-secondary-content mb-6 bg-secondary w-full placeholder:text-blue-800 placeholder-black::placeholder placeholder:text-blue-800"),a(o,"type","text"),a(o,"placeholder","fx. Valdemar"),a(p,"class","grow mr-3"),a(y,"class","input text-secondary-content mb-6 bg-secondary w-full placeholder:text-blue-800"),a(y,"type","text"),a(y,"placeholder","fx. 5"),a(_,"class","grow"),a(c,"class","flex w-full"),a(r,"class","flex"),a(g,"class","textarea block bg-secondary h-10 mb-10 w-full placeholder:text-blue-800"),a(g,"name",""),a(g,"id",""),a(g,"placeholder","fx. Historien skal handle om en drage med hat p\xE5"),a(m,"class","input text-secondary-content mb-6 bg-secondary w-full placeholder:text-blue-800"),a(m,"type","password"),a(m,"placeholder",""),a(j,"class","input text-secondary-content mb-6 bg-secondary w-full placeholder:text-blue-800"),a(j,"type","password"),a(j,"placeholder",""),a(l,"class","p-6 text-2xl w-full flex flex-col justify-items-center"),x(l,"margin","0 auto"),x(l,"max-width","800px")},m(s,w){A(s,e,w),A(s,n,w),A(s,l,w),u(l,r),u(r,c),u(c,p),u(p,i),u(p,f),u(p,o),N(o,t[0]),u(c,v),u(c,_),u(_,P),u(_,O),u(_,y),N(y,t[2]),u(l,H),u(l,$),u(l,D),u(l,g),N(g,t[1]),u(l,L),u(l,b),u(l,h),u(l,m),N(m,t[3]),u(l,K),u(l,k),u(l,R),u(l,j),N(j,t[4]),u(l,ae),B.m(l,null),A(s,le,w),T&&T.m(s,w),A(s,Y,w);for(let E=0;E<C.length;E+=1)C[E].m(s,w);A(s,G,w),re||(ue=[M(o,"input",t[9]),M(y,"input",t[10]),M(g,"input",t[11]),M(m,"input",t[12]),M(j,"input",t[13])],re=!0)},p(s,[w]){if(w&1&&o.value!==s[0]&&N(o,s[0]),w&4&&y.value!==s[2]&&N(y,s[2]),w&2&&N(g,s[1]),w&8&&m.value!==s[3]&&N(m,s[3]),w&16&&j.value!==s[4]&&N(j,s[4]),Q===(Q=fe(s))&&B?B.p(s,w):(B.d(1),B=Q(s),B&&(B.c(),B.m(l,null))),s[6].length>0?T||(T=we(),T.c(),T.m(Y.parentNode,Y)):T&&(T.d(1),T=null),w&320){F=s[6];let E;for(E=0;E<F.length;E+=1){const pe=be(s,F,E);C[E]?C[E].p(pe,w):(C[E]=xe(pe),C[E].c(),C[E].m(G.parentNode,G))}for(;E<C.length;E+=1)C[E].d(1);C.length=F.length}},i:z,o:z,d(s){s&&I(e),s&&I(n),s&&I(l),B.d(),s&&I(le),T&&T.d(s),s&&I(Y),Le(C,s),s&&I(G),re=!1,J(ue)}}}const V=!1;function Ue(t,e,n){let l,r,c,p,i,f=ye("OPENAI_KEY")?sessionStorage.getItem("OPENAI_KEY"):"",o=ye("STADIFF_KEY")?sessionStorage.getItem("STADIFF_KEY"):"",v=!1;const _=async()=>{f&&sessionStorage.setItem("OPENAI_KEY",f),o&&sessionStorage.setItem("STADIFF_KEY",o),n(5,v=!0),console.log("original prompt: ",p);let g=await ee({prompt:p,fake:V,openAiKey:f}).catch(m=>{alert(m)});g=g.replaceAll(' "',`

"`),g=g.replaceAll('" ',`"

`),console.log("story: ",g),n(5,v=!1),i.push({story:g,prompt:p}),n(6,i),setTimeout(()=>{document.getElementById("chap-"+(i.length-1)).scrollIntoView({behavior:"smooth",block:"start"})},100),console.log(i);const L=`${g} 
One line english summary: `,b=await ee({prompt:L,fake:V,openAiKey:f}).catch(m=>{alert(m)});console.log("Summary: ",b);const h=`${b} Children's Book Illustration, taylor barron, basia tran`.replace(l,"a child");console.log(h),console.log("Image prompt: ",h),console.log(o,f),_e({prompt:h,fake:V,stableDiffusionKey:o}).then(m=>{n(6,i=i.map((K,k)=>k===i.length-1?{...K,image:m}:K)),console.log(i),n(5,v=!1)}).catch(m=>{alert(m)})},P=async g=>{const L=g.target;g.target.children[0].style.display="none",g.target.children[1].style.display="",console.log("previous:",i[i.length-1]),console.log("next prompt",[p,...i.map(k=>k.story)].join(" "));const b=await ee({prompt:[p,...i.map(k=>k.story)].join(" "),fake:V,openAiKey:f}).catch(k=>{alert(k)});i.push({story:b}),n(6,i),setTimeout(()=>{document.getElementById("chap-"+(i.length-1)).scrollIntoView({behavior:"smooth",block:"start"})},100);const h=`${b} 
One line summary: `,K=`${await ee({prompt:h,fake:V,openAiKey:f}).catch(k=>{alert(k)})} Children's Book Illustration, taylor barron, basia tran`.replace(l,"a child");_e({prompt:K,fake:V,stableDiffusionKey:o}).then(k=>{n(6,i=i.map((R,j)=>j===i.length-1?{...R,image:k}:R))}).catch(k=>{alert(k)}),L.parentNode.remove()};function O(){l=this.value,n(0,l)}function y(){r=this.value,n(2,r)}function H(){c=this.value,n(1,c)}function $(){f=this.value,n(3,f)}function D(){o=this.value,n(4,o)}return t.$$.update=()=>{t.$$.dirty&7&&(p=`Det f\xF8lgende er en historie til en ${r} \xE5rig barn, barnet hedder ${l}. ${c}. 
`)},n(0,l=""),n(2,r=""),n(1,c=""),n(6,i=[]),[l,c,r,f,o,v,i,_,P,O,y,H,$,D]}class Xe extends Oe{constructor(e){super(),Ce(this,e,Ue,qe,ke,{})}}function Je(t){let e,n,l;return n=new Xe({}),{c(){e=d("main"),Me(n.$$.fragment),a(e,"class","bg-primary"),x(e,"min-height","100vh")},m(r,c){A(r,e,c),Ee(n,e,null),l=!0},p:z,i(r){l||(Ie(n.$$.fragment,r),l=!0)},o(r){Ke(n.$$.fragment,r),l=!1},d(r){r&&I(e),Ae(n)}}}class Qe extends Oe{constructor(e){super(),Ce(this,e,null,Je,ke,{})}}new Qe({target:document.getElementById("app")});
